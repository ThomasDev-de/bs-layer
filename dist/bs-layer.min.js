(function($){"use strict";$.bsLayer={version:"1.0.0",getDefaults:function(){return this.defaults},getConfig:function(){return this.config},config:{distanceBetweenLayers:100,animationDuration:400,zIndexStart:1050,parent:"body",icons:{close:"bi bi-x-lg",maximize:"bi bi-arrows-angle-expand",minimize:"bi bi-arrows-angle-contract"}},defaults:{title:null,width:undefined,backdrop:"static",url:null,closeable:true,queryParams(params){return params},onAll:function(eventName,...args){},onLoad:function($content){},onShow:function($layer){},onShown:function($layer){},onHide:function(){},onHidden:function(){}},vars:{isAnimating:false,registerGlobalLayerEvents:false,immediate:false,openLayers:[]},close:close,closeAll:closeAll,utils:{getUniqueId(prefix="bs_layer_"){const randomId=Math.random().toString(36).substring(2,10);return prefix+randomId},isValueEmpty(value){if(value===null||typeof value==="undefined"){return true}if(Array.isArray(value)){return value.length===0}if(typeof value==="string"){return value.trim().length===0}return false},executeFunction(functionOrName,...args){if(!functionOrName){return undefined}let func;if(typeof functionOrName==="function"){func=functionOrName}else if(typeof functionOrName==="string"){if(typeof window!=="undefined"&&typeof window[functionOrName]==="function"){func=window[functionOrName]}else{console.error(`Die Funktion "${functionOrName}" konnte nicht im globalen Kontext gefunden werden.`);return undefined}}if(!func){console.error(`UngÃ¼ltige Funktion oder Name: "${functionOrName}"`);return undefined}return func(...args)}}};const namespace=".bs.layer";$.fn.bsLayer=function(optionsOrMethod){if($(this).length===0)return;if($(this).length>1){return $(this).each(function(){return $(this).bsLayer(optionsOrMethod)})}const $layerButton=$(this);if(!$layerButton.data("dataBsLayer")){$layerButton.addClass("btn-layer");const options=typeof optionsOrMethod==="object"?optionsOrMethod:{};const settings=$.extend(true,{},$.bsLayer.getDefaults(),$layerButton.data(),options);const dataBsLayer={settings:settings};$layerButton.data("dataBsLayer",dataBsLayer);btnEvents($layerButton)}if(!$.bsLayer.vars.registerGlobalLayerEvents){globalEvents();$.bsLayer.vars.registerGlobalLayerEvents=true}if(typeof optionsOrMethod==="string"){switch(optionsOrMethod){case"show":{$layerButton.trigger("click"+namespace)}break}}return $layerButton};function triggerEvent($btnLayer,eventName,...args){const $btn=$($btnLayer);const settings=getSettings($btn);const event=$.Event(eventName+namespace);$btn.trigger(event,args);event.stopPropagation();if(eventName!=="all"){const allEvent=$.Event(`all${namespace}`);$btn.trigger(allEvent,[eventName+namespace,...args]);$.bsLayer.utils.executeFunction(settings.onAll,eventName+namespace,...args);allEvent.stopPropagation();const eventFunctionName=`on${eventName.split("-").map(word=>word.charAt(0).toUpperCase()+word.slice(1)).join("")}`;$.bsLayer.utils.executeFunction(settings[eventFunctionName],...args)}}function getSettings($btnLayer){return $btnLayer.data("dataBsLayer").settings}function btnEvents($btnLayer){$btnLayer.on("click"+namespace,function(e){e.preventDefault();if($.bsLayer.vars.isAnimating||$(".bs-layer.sliding").length){return}open($(e.currentTarget))})}function globalEvents(){$(document).on("click"+namespace,".bs-layer .btn-toggle-full-width",function(e){e.preventDefault();const $layer=$(e.currentTarget).closest(".bs-layer");const config=$.bsLayer.getConfig();const $layerMaxMinBtn=$layer.find(".btn-toggle-full-width i");$layer.toggleClass("w-100");$layerMaxMinBtn.removeClass(config.icons.maximize).removeClass(config.icons.minimize);if($layer.hasClass("w-100")){$layer.removeClass("rounded-start-5");$layerMaxMinBtn.addClass(config.icons.minimize)}else{$layer.addClass("rounded-start-5");$layerMaxMinBtn.addClass(config.icons.maximize)}}).on("click"+namespace,'[data-bs-dismiss="layer"]',function(e){e.preventDefault();close()}).on("click"+namespace,"#layerBackdrop",function(e){e.preventDefault();if($.bsLayer.vars.isAnimating||$(".bs-layer.sliding").length){return}const backdropOpt=$.bsLayer.defaults.backdrop;if(backdropOpt==="static"){return}close()});$(document).on("keydown"+namespace,function(e){if(e.key==="Escape"){const backdropOpt=$.bsLayer.defaults.backdrop;if(backdropOpt==="static")return;if($(".bs-layer.sliding").length){return}close()}})}function getCurrentWidth($btnLayer){const settings=getSettings($btnLayer);const config=$.bsLayer.getConfig();const countOpenLayers=$.bsLayer.vars.openLayers.length;const winWidth=$(window).width();if(winWidth<576){return winWidth}if(countOpenLayers===1){return Math.round(winWidth*.8)}if(settings.width){return settings.width}const prevWidth=$.bsLayer.vars.openLayers[$.bsLayer.vars.openLayers.length-2].width?$.bsLayer.vars.openLayers[$.bsLayer.vars.openLayers.length-2].width():Math.round(winWidth*.8);return Math.max(prevWidth-config.distanceBetweenLayers,576)}function getCurrentZIndex(){const config=$.bsLayer.getConfig();const countOpenLayers=$.bsLayer.vars.openLayers.length;return config.zIndexStart+countOpenLayers}function getLoading(){return['<div class="d-flex justify-content-center fs-1 align-items-center h-100 w-100">','<div class="spinner-border text-primary" style="width: 5rem; height: 5rem;" role="status">','<span class="visually-hidden">Loading...</span>',"</div>","</div>"].join("")}function getTemplate($btnLayer){const config=$.bsLayer.getConfig();const settings=getSettings($btnLayer);const closeableBtn=!settings.closeable?"":[`<button type="button" class="btn" data-bs-dismiss="layer"><i class="${config.icons.close}"></i></button>`].join("");const maxMinBtn=!settings.closeable?"":[`<button type="button" class="btn btn-toggle-full-width"><i class="${config.icons.maximize}"></i></button>`].join("");return['<div class="d-flex flex-column align-items-stretch h-100 w-100">','<div class="layer-header d-flex flex-nowrap justify-content-between align-items-center p-3">',`<h5 class="layer-title">${settings.title||""}</h5>`,'<div class="btn-group">',maxMinBtn,closeableBtn,"</div>","</div>",'<div class="layer-body p-3 flex-fill overflow-y-auto"></div>',"</div>"].join("")}function getOrCreateTarget($btnLayerElement){const $btnLayer=$($btnLayerElement);let target;if($btnLayer.is("a")){let href=$btnLayer.attr("href");if($.bsLayer.utils.isValueEmpty(href)||href==="#"){const newId=$.bsLayer.utils.getUniqueId();$btnLayer.attr("href","#"+newId);target=newId}else if(href.charAt(0)==="#"){target=href.substring(1)}else{target=href}}else if($btnLayer.is("button")){let dataTarget=$btnLayer.attr("data-bs-target");if($.bsLayer.utils.isValueEmpty(dataTarget)||dataTarget==="#"){const newId=$.bsLayer.utils.getUniqueId();$btnLayer.attr("data-bs-target","#"+newId);target=newId}else if(dataTarget.charAt(0)==="#"){target=dataTarget.substring(1)}else{target=dataTarget}}return target}function handleLayerContent($btnLayer,$layerBody,res){const $content=$(res);$($layerBody).empty().append($content);triggerEvent($btnLayer,"load",$content)}function open($btnLayer){if($.bsLayer.vars.isAnimating){return}$.bsLayer.vars.isAnimating=true;const settings=getSettings($btnLayer);const config=$.bsLayer.getConfig();let target=getOrCreateTarget($btnLayer);const animationDuration=config.animationDuration;const $menu=$("<div>",{"data-bs-theme":"light",id:target,html:getTemplate($btnLayer)}).appendTo(config.parent);$menu.data("controller",$btnLayer);$.bsLayer.vars.openLayers.push($menu);const width=getCurrentWidth($btnLayer);const zIndex=getCurrentZIndex();$menu.addClass("position-fixed text-dark top-0 h-100 rounded-start-5 bs-layer sliding").css({width:width+"px",right:"-"+width+"px",zIndex:zIndex,transition:"right "+animationDuration+"ms",display:"block",background:"rgba(255, 255, 255, 0.74)",boxShadow:"0 16px 80px rgba(0, 0, 0, 0.7)",backdropFilter:"blur(9.1px)",WebkitBackdropFilter:"blur(9.1px)"}).attr("aria-modal","true").attr("role","layer");const layerBody=$menu.find(".layer-body");layerBody.html(getLoading());if(settings.url){const query=typeof settings.queryParams==="function"?settings.queryParams():{};let promise;if(typeof settings.url==="function"){promise=$.bsLayer.utils.executeFunction(query)}else{promise=$.ajax({url:settings.url,type:"GET",data:query,contentType:"application/x-www-form-urlencoded; charset=UTF-8"})}if(promise&&typeof promise.then==="function"){promise.then(function(res){handleLayerContent($btnLayer,layerBody,res)}).catch(function(error){console.error("Error loading the layer:",error)})}else{console.error("Settings.url must either be a function with a promise or a string url!")}}void $menu[0].offsetWidth;$menu.css("right","0");for(let i=0;i<$.bsLayer.vars.openLayers.length-1;i++){$.bsLayer.vars.openLayers[i].addClass("overflow-hidden")}$menu.removeClass("overflow-hidden");if(settings.backdrop){let $backdrop=$("#layerBackdrop");if($backdrop.length===0){$backdrop=$('<div id="layerBackdrop" class="modal-backdrop fade show"></div>').appendTo("body")}else{$backdrop.appendTo("body")}const backdropZ=zIndex-1;$backdrop.css({zIndex:backdropZ})}if($.bsLayer.vars.openLayers.length===1){$("body").addClass("overflow-hidden")}triggerEvent($btnLayer,"show",$menu);bsLayerTimeout(()=>{$menu.css("transition","none");triggerEvent($btnLayer,"shown",$menu);$menu.removeClass("sliding");$menu.addClass("show");$($btnLayer).data("layer",$menu);$.bsLayer.vars.isAnimating=false},animationDuration)}function close(){if($.bsLayer.vars.isAnimating){return}$.bsLayer.vars.isAnimating=true;const settings=$.bsLayer.defaults;const config=$.bsLayer.getConfig();const animationDuration=config.animationDuration;const $layer=$.bsLayer.vars.openLayers[$.bsLayer.vars.openLayers.length-1];const $layerBtn=$layer.data("controller");const width=$layer&&$layer.outerWidth?$layer.outerWidth():0;$layer.css("transition","right "+animationDuration+"ms");if($layer){triggerEvent($layerBtn,"hide")}if(settings.backdrop){if($.bsLayer.vars.openLayers.length===1){$("#layerBackdrop").remove()}else if($.bsLayer.vars.openLayers.length>1){const $underLayer=$.bsLayer.vars.openLayers[$.bsLayer.vars.openLayers.length-2];const zIndex=$underLayer&&$underLayer.css?parseInt($underLayer.css("z-index"),10)||1050:1050;$("#layerBackdrop").css({zIndex:zIndex-1})}}if($layer&&$layer.css){$layer.css("right","-"+width+"px");$layer.addClass("sliding");setTimeout(function(){$layer.hide(function(){triggerEvent($layerBtn,"hidden");$layer.remove();$.bsLayer.vars.openLayers.pop();if($.bsLayer.vars.openLayers.length){$.bsLayer.vars.openLayers[$.bsLayer.vars.openLayers.length-1].removeClass("overflow-hidden")}else{$("body").removeClass("overflow-hidden")}$.bsLayer.vars.isAnimating=false})},animationDuration)}else{$.bsLayer.vars.isAnimating=false}}function closeAll(){const vars=$.bsLayer.vars;if(vars.isAnimating||!vars.openLayers.length){return}function closeNext(){if(!vars.openLayers.length)return;close();if(vars.openLayers.length>0){setTimeout(function waitAndClose(){if(!vars.isAnimating){closeNext()}else{setTimeout(waitAndClose,30)}},30)}}closeNext()}function bsLayerTimeout(callback,duration){if($.bsLayer.vars.immediate||duration===0){callback();return null}else{return setTimeout(callback,duration)}}})(jQuery);